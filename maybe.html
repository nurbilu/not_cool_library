<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <label for="book">Book Name:</label>
    <input id="book" type="text">
    <label for="author">Author:</label>
    <input id="author" type="text">
    <button onclick="first()">First</button>
    <button onclick="next()">Next</button>
    <button onclick="prev()">Prev</button>
    <button onclick="last()">Last</button> |
    <button onclick="addData()">Add</button>
    <button onclick="delData()">Del</button>
    <button onclick="updateData()">Update</button>
    <div id="display"></div>

    <script>
        const MY_SERVER = "http://localhost:3000/books"
        let books = [];
        let index = 0;

        async function updateData() {
            try {
                const updatedBook = {
                    book: document.getElementById('book').value,
                    author: document.getElementById('author').value
                };

                const response = await fetch(`${MY_SERVER}/${index}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedBook),
                    headers: {
                        'Content-type': 'application/json; charset=UTF-8',
                    },
                });

                if (response.ok) {
                    const json = await response.json();
                    console.log(json);
                } else {
                    console.error('Update failed:', response.status);
                }
            } catch (err) {
                console.error(err);
            }
        }

        async function delData() {
            try {
                const response = await fetch(`${MY_SERVER}/${index}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    console.log('Deleted successfully');
                    // Update the books array after deletion
                    books.splice(index, 1);
                    if (index >= books.length) {
                        index = books.length - 1;
                    }
                    updDisplay();
                } else {
                    console.error('Deletion failed:', response.status);
                }
            } catch (err) {
                console.error(err);
            }
        }

        async function getData() {
            try {
                const response = await fetch(MY_SERVER);
                if (response.ok) {
                    books = await response.json();
                    updDisplay();
                } else {
                    console.error('Failed to fetch data:', response.status);
                }
            } catch (err) {
                console.error(err);
            }
        }

        async function addData() {
            try {
                const newBook = {
                    book: document.getElementById('book').value,
                    author: document.getElementById('author').value
                };

                const response = await fetch(MY_SERVER, {
                    method: 'POST',
                    body: JSON.stringify(newBook),
                    headers: {
                        'Content-type': 'application/json; charset=UTF-8',
                    },
                });

                if (response.ok) {
                    const json = await response.json();
                    console.log(json);
                    books.push(newBook); // Add the new book to the array
                    index = books.length - 1; // Set index to the newly added book
                    updDisplay();
                } else {
                    console.error('Addition failed:', response.status);
                }
            } catch (err) {
                console.error(err);
            }
        }

        function updDisplay() {
            const display = document.getElementById('display');
            const bookInput = document.getElementById('book');
            const authorInput = document.getElementById('author');

            if (bookInput && authorInput) {
                bookInput.value = books[index]?.book || '';
                authorInput.value = books[index]?.author || '';
            }

            display.innerHTML = `${index + 1} from ${books.length}`;
        }

        function first() {
            index = 0;
            updDisplay();
        }

        function next() {
            if (index < books.length - 1) {
                index++;
            }
            updDisplay();
        }

        function prev() {
            if (index > 0) {
                index--;
            }
            updDisplay();
        }

        function last() {
            index = books.length - 1;
            updDisplay();
        }

        getData();
    </script>
</body>
</html>
